.page
  .wrap
    %h1#status Loading...

  #body

  .wrap
    %ul
      %li= link_to 'Powify.dev on github', 'https://github.com/sethvargo/powify.dev'

:javascript
  $(function() {
    $.ajax({
      url : '#{proxy_url(:format => :json)}',
      type : 'GET',
      success : function(data, status, xhr) {
        changeIcon('ok');
        setTitle('Pow is running');
        addStatus(data.status);
        addConfig(data.config);
        addApps(data.apps);
      },
      failure : function(data, status, xhr) {
        changeIcon('err');
        setTitle('Pow is not running');
      }
    });
  });

  function changeIcon(newIcon) {
    $('#status').addClass(newIcon);
  }

  function setTitle(newTitle) {
    $('#status').html(newTitle);
  }

  function addStatus(statusJSON) {
    var $status = $('<div id="status" class="none"></div>');
    var $preStatus = $('<pre id="pre-status" class="breakout"></pre>');
      $preStatus.html('<h2>Server Status</h2>');

    $.each(statusJSON, function(key, value) {
      $preStatus.append('<strong>'+key+'</strong>: '+value);
      $preStatus.append('\n');
    });

    $status.append($preStatus);
    $('#body').append($status);
    $status.slideDown('slow');
  }

  function addConfig(configJSON) {
    var $config = $('<div id="config" class="none"></div>');
    var $preConfig = $('<pre id="pre-config" class="breakout"></pre>');
      $preConfig.html('<h2>Server Config</h2>');

    $.each(configJSON, function(key, value) {
      $preConfig.append('<strong>'+key+'</strong>: '+value);
      $preConfig.append('\n');
    });

    $config.append($preConfig);
    $('#body').append($config);
    $config.slideDown('slow');
  }

  function addApps(appsJSON) {
    var $apps = $('<div id="apps"></div>');

    $.each(appsJSON, function(app, data) {
      buildApp(app, data);
    });
  }

  function buildApp(app, data) {
    var $app = $('<div id="'+app+'"></div>');
    var $preApp = $('<pre id="pre-'+app+'" class="breakout"></pre>');
      $preApp.html('<h2>'+app+'</h2>');

    $app.append($preApp);

    $('#body').append($app);
  }